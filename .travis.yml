sudo: required

language: node_js
node_js:
  - "8"

services:
  - docker

addons:
  apt:
    packages:
      - docker-ce
      - kpartx
      - qemu-user-static
      - aria2

install:
  - sudo service docker stop && sudo rm -rf /var/lib/docker && sudo service docker start

script: mkdir images && sudo PATH=./node_modules/.bin:$PATH ./treehouse-builder --noninteractive

env:
  secure: "CF32D6FWCZxhAu4Dn2pzsLcuiEWI7lhT6Fw6/xsUx0wZ5ggRAe1SkMkH6tOsY+zjiyvghbCUvXS4tPziS6nzLmy0tZrzx72Tms5ysDL9q10/EEkRG+SONe16HLlcWr90/kgHFnl+q1pOuoCIY0Eib/HiAh5mQjojvqKYDU3oM95ruhiStoCaIAqvYvf6i2ZGgwdlLcb0cSZKx33KIABXbHDinT1lDtPa6eYfe+m5RB3GikdrE+d1ETjEsTTz2oI3zvA87Y2FukST17OvQzbKNZ0L5Y2UC+yhWCnbiIiZkOBQ80aKPHYMLLO8VX88gBxWslDmglkWmEpL9To75dbJ6T0FJ3iylCncm7TAQAA+/YErpvjdo36B4I37gYDbZMLwUbWr3js6ST7tXIAHJlSJdrthszEyYON22W5YQN+JWVZdOea3bYU2Ys48FW53SdVPUWcy8II8r9VoU6llGUgnEAmjpPNxZJvKgXoFEmfK1MsiRP98AnMNi+BuD8AITaFVn6YGyivJnFOgISG6V9/CqCpP/DKXqqEkV7gIY/CP79Opcca5MbrOZXtq/9GIEjXibEOCJMMjHt0lMxQbpvxGxm2hoj3cZyqA5WR737h70tUgkjty/NrHuqwk712n3L/AsHuFOOl8VVp8fHTiPRjjx914SCdOKJB6aGz7sPGewKQ="

before_deploy:
  - echo "$ssh_deploy_key" > .travis/id_deploy

deploy:
  provider: script
  skip_cleanup: true
  script: ./.travis/deploy.sh
  on:
    all_branches: true
    tags: true

notifications:
  webhooks:
    urls:
      secure: "Aqo5s4yLOboXOWnK2WfafKQidLe/dlyOEt3hZbQqSX7XiiNgfTaUjkmFJjQrpMcx0lShlW0amd5UadvDbu5PFajaSqW7xagpxTof0w6JWTlaVseQ38olpXn1IgDqJH679ZnOQYpoFKNnvvgQNJ9+xs4lCDitQc+aHVdhVVfxBGQQtj+AOBv6+ILciTCmk+ComzbLjUxSj/TWnao2kR+x2GyXwZ7l3TXnX1/2/c9LCAwh9oA9t5nvvuZBoj3Uk1XHQWpFzfMEltOdCgYyhVqOddlfDNch7HqeHZQU0Y+B9zm3v4lM8s4DaX7gfofjw4yKi5Uj+pT+KePNNIjv+OPsyiXWqhIA7X2N4OSgbr7Fbvlf/IM3vPL+7Su7UtvR5mLUPMa+jEGARsJE68IOpss+oy2x2u2AHKKRA9rtGacVNPt/2EPMZiXSqGRsclft3dEVNEM4ryOZJNg/XHbPNtxEpKsBhPwD1ZpBkp/2NWNojpMTdUbYln1cEwcP6vl+c1KwJsbGs8tjm7ojuGmhAVHDdvm1WsVClROypgjsKiO17lOKOknq3Bv74L8s25Vz0ffDdcaHC2PBvNk2gTbl7Eu675rHujhcHZjXbw1UaTcNO9ZqlQTFXn72x76rIGmuopzKrouxdqAwJe5L2tFjAWYq+8m7/k+ZeuEG2vdDvss9vGc="
      on_success: always # one of: always, never, change
      on_failure: always
      on_start: never
